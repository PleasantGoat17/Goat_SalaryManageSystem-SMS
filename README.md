# 一、系统概述

通过对人事管理管理部门中的岗位、职称、工资、员工、部门、工资类别等相关内容进行分析，完成具有人员管理、工资管理、部门管理等相关功能的小型数据库管理应用系统，系统需要具备增减工资中应发、应扣类别的灵活性，以适应将来需求的变化。
基本要求 ：
1.	需求如下：
    - 一个员工属于某个部门，一个部门有多个员工，每个部门有部门经理；
    - 各个部门之上有总部，总部设置总经理、副总经理；每个部门有下属的分部门，各个分部门也设定分部经理；总部、部门、分部形成了多级管理；
    - 一个员工有一个职称，一个职称可以有多个员工，员工在不同时期具有的不同职称需要保留供查询；
    - 集团每个月都会产生一份工资表，保留备查以及可能的分析统计。
    - 每个职称有职称工资，属于工资类别的一种；员工当月工资发放之前改变了职称，当月工资按新的职称计算职称工资；员工当月工资发放之后改变了职称，下月工资按新的职称计算职称工资；
    - 除了总经理、副总经理、部门经理、分部经理之外，还可设置项目经理、产品经理、测试经理、研发工程师、项目助理等岗位，岗位工资属于工资类别的一种；员工当月工资发放之前改变了岗位，当月工资按新的岗位计算岗位工资；员工当月工资发放之后改变了岗位，下月工资按新的岗位计算岗位工资；
    - 员工在公司服务期间，每年/每月300元工龄工资；比如：满1年每月300元工龄工资、满2年每月600元工龄工资、依次递进；工龄的计算以入职时间的年月为依据，比如：2022-01-10入职，2023-02月开始每月有300元的工龄工资，2024-02月开始每月有600元的工龄工资；
    - 员工请假1天扣100元，迟到早退1次扣50元，旷工1天扣300元，满勤奖励300元，系统要根据考勤情况计算缺勤工资、全勤奖励；
    - 除了岗位工资、职称工资、工龄工资、缺勤工资、全勤奖励之外，工资类别还可以设计基本工资、项目补贴、个税扣除等；
    - 每月工资设定发放日，上月发放日之后到本月发放日之前，员工的各工资类别可以获取的工资可以手动修改的（比如项目补贴、个税扣除、缺勤扣除等）用户可以修改，系统计算的（比如岗位工资、职称工程、基本工资、工龄工资）只能通过“计算”功能进行计算，“计算”功能会把用户手工输入和系统计算的全部一起计算后生成当月工资；
    - 工资发放日之后不能修改发放日之前的工资；在新的发放日的凌晨一点设定定时任务，计算新的月度的工资发放表初始数据；
    - 输出各类统计报表。使用编程工具编码实现的建议所有的报表数据用存储过程实现数据获取，降低网络传输量，利用集合运算的优势提升查询速度，提高数据独立性。

2.	完成岗位、职称、员工、部门、工资类别等基础数据的维护（增删改查），并进行数据准备。注意其中部门是多级部门。其中员工和部门数据的获取要求通过视图实现，要求员工信息视图直接输出部门名称，部门信息视图直接输出部门经理姓名。
3.	完成考勤表的维护（增删改查）。
4.	完成需要手动录入的员工各工资类别的月度工资（基本工资、项目补贴、个税扣除）的维护（增删改查），其中基本工资一般和上月一样，特殊情况才需要修改。
5.	工龄工资要求在数据库端完成全部的计算并保存在单独的一张表。
6.	缺勤工资要求利用触发器、数据表在手动增删改考勤数据时实时动态更新。
7.	设计存储过程完成“计算”功能，生成当月工资发放表；工资发放表生成后，可以按员工、部门进行查询、打印。
8.	完成定时任务的设计。
9.	按年度计算各工资类别的合计金额以及分别占年度工资发放总额的比率，并输出报表。
10.	按部门计算月度最高、最低、平均工资、年度最高、最低、平均工资并输出；按员工计算年度平均工资并输出
11.	设定2类角色：个人、财务，个人只能查看自己的工资，财务可以查看全部员工的工资，另外：总经理、副总经理、部门经理、分部经理虽然是个人角色，但可查看各自部门员工（含个人）的工资。个人查看工资要求用存储过程实现，且要求如果个人职务是分部经理及以上，看到的是含个人的本部门全部员工的工资，其中个人的工资置顶。
12.	运维需求变更案例：由于全球的经济形势下滑，公司调整了工龄工资的计算方法为：1年工龄仍为300元/月，但从第2年开始，每年只增加100元/月，即2年工龄工资400元/月，3年工龄工资500元/月。并要求原来的计算方法保留且正常计算，在公司恢复经济活力后，会恢复原来的计算方法，按新的计算方法少发的工龄工资将适度补发。提示：登记新的计算方法生效日期、结束日期，新增一张表保存按新方法计算出来的工龄工资，“计算”存储过程取工龄工资时判断发放月度是否在新方法的有效期内，在有效期内则取新表的工龄工资，否则取旧表的数据。新方法结束日期为空取当前时间的日期。通过这样处理，修改新方法的生效日期结束日期就可以随时在新旧方法间进行切换，而无需修改任何应用程序代码，实现了比较高的数据独立性。

本题目所需的知识点：E-R实体联系图；数据库表设计；数据库表维护；视图；触发器；存储过程；数据独立性；定时任务等。

# 二、要求
1.	在对数据库理论及知识理解的基础上，完成相关的算法与程序，重点是针对具体的实际问题选择并设计合适的数据库表加以应用。
2.	按数据库设计的各阶段完成整个课程设计：

    1）	需求分析：根据选定的题目（可以是“七、”中提供的项目，也可以自拟定），描述项目的需求。
    2）	概念结构设计：根据需求分析的内容进行概念结构的设计，可以借助powerDesigner或workBench等辅助工具进行设计，得到E-R实体联系图、概要设计报告（使用powerDesigner设计的可以直接生成），并给出必要的数据流图。
    该阶段强烈建议使用辅助设计工具，提高生产效率。
    3）	逻辑结构设计：把E-R图转化为MySQL支持的数据库表（使用powerDesigner或workBench设计的可以直接生成），并分析主键、外键是否合理设置，候选码是否都设置了惟一约束或惟一索引（二选一）来保证码的完整性。该阶段同步给出系统的功能模块结构图以及主要的程序流程图。
    该阶段还需考虑设计必要的冗余数据列和冗余数据表，用来提升一些复杂查询、统计查询的效率。
    该阶段还需考虑生产业务数据不允许物理删除只能逻辑删除，以实现数据痕迹保留。
    4）	物理结构设计：进一步分析数据表的属性列哪些经常出现在where查询条件中、哪些经常出现在连接条件中、哪些列经常成对出现在where条件中等，通过分析设计必要的合适的索引（含组合索引）提升查询效率。对于多属性组合主键，可以增加自增ID列作为主键，而把实际的多属性组合主键通过惟一索引设为组合候选码。
    因为课程设计时间短，本阶段不考虑分库分区分表等存储方式的设计。
    5）	数据库实施：选择一种编程工具（VC++、.NET、Java、Python等）编写代码实现设计的数据库系统，或者选择直接在数据库端编写存储过程实现数据库表的增删改并给出测试调用SQL代码。无论选择哪种实现方式，对于系统的基础数据要求全部使用SQL代码进行批量数据插入删除来实施。
    该阶段要求设计必要的视图或存储过程来实现外模式，提高数据独立性；设计必要的触发器实现用户自定义完整性以及冗余数据和冗余表的维护；设计必要的存储过程实现全部统计报表的输出。
    其中：使用编程工具编码实现的需要实现各类单据和各种报表的打印功能，数据库端实现的能通过存储过程实现数据展示即可。
    6）	数据库运行和维护：通过程序界面运行系统进行生产数据的维护以及各类报表的查询打印，或数据库端的测试SQL代码进行生产数据的维护以及报表的输出。
    该阶段要求根据项目实际情况，设计一些数据列属性（数据类型、长度等）改变、自定义完整性约束要求改变等案例，并在数据库端完成这些改变而不需要去修改业务逻辑代码来完成运维，充分体会数据独立性在运维阶段的独特优势。
3.	根据“2”中各阶段的设计完成规范化的课程设计说明书的编写；
4.	在选题时，一人一题，除了“七、”中提供的项目外，同学们也可根据自己现实工作或生活的实际需要和能力，自选课程设计题目，要求难易适中，业务情况容易了解，涉及其他专业的"专业性"不要太强。
5.	部分能力强的同学在完成课程设计的基础上，可考虑通过redis内存数据库来实现登录、基础数据的缓存，以应对未来高并发、大数据量情况下的可用性。

# 三、应交文档资料

1. 课程设计说明书纸质文档，主要包括以下内容：
1) 课程设计的题目；
2）数据流图描述的系统功能需求结果；
3）系统的总功能和各子模块的功能；
4) 程序流程图及主要算法简述；
5) E-R实体联系图和数据库表结构的详细情况；
6) 数据库设计中建立的视图、触发器、存储过程的代码；
7) 课程设计的总结，主要包括以下内容：
（1）课程设计中遇到的主要问题和解决方法；
（2）创新和得意之处；
（3）课程设计中存在的不足，需进一步改进的设想；
（4）课程设计的感想和心得体会。

以上内容均填写在《课程设计说明书》上，要求干净整洁，符合课程设计的要求和规范（学校教务处或者分院网站下载）。
《课程设计说明书》要求在课程设计结束一周内以“学号-姓名-数据库系统课程设计说明书”命名压缩打包再按班级以“xxx班-数据库系统课程设计说明书”命名压缩打包提交给各自的带队老师。 

# 附件：数据表结构设计

1. **Employee** (员工表)
   - **字段**:
     - `EmployeeID` (员工编号, INT, PK)
     - `Name` (姓名, VARCHAR(50))
     - `TitleID` (职称编号, INT, FK)
     - `DepartmentID` (部门编号, INT, FK)
     - `PositionID` (职位编号, INT, FK)
     - `HireDate` (入职日期, DATE)
     - `BasicSalary` (基本工资, DECIMAL(10, 2))
   - **依赖表**:
     - `Department` (部门表)
     - `Position` (职位表)
     - `Title` (职称表)

2. **Department** (部门表)
   - **字段**:
     - `DepartmentID` (部门编号, INT, PK)
     - `Name` (部门名称, VARCHAR(50))
     - `ParentDepartmentID` (上级部门编号, INT, FK, 自引用)
     - `ManagerID` (部门经理编号, INT, FK)
   - **依赖表**:
     - 自引用 (`ParentDepartmentID` 引用 `DepartmentID`)
     - `Employee` (员工表)（`ManagerID`）

3. **Position** (职位表)
   - **字段**:
     - `PositionID` (职位编号, INT, PK)
     - `Name` (职位名称, VARCHAR(50))
     - `Salary` (职位工资, DECIMAL(10, 2))
   - **依赖表**:
     - 无

4. **Title** (职称表)
   - **字段**:
     - `TitleID` (职称编号, INT, PK)
     - `Name` (职称名称, VARCHAR(50))
     - `Salary` (职称工资, DECIMAL(10, 2))
   - **依赖表**:
     - 无

5. **SalaryCategory** (工资类别表)
   - **字段**:
     - `CategoryID` (类别编号, INT, PK)
     - `Name` (类别名称, VARCHAR(50))
     - `IsManual` (是否手动调整, BOOLEAN)
   - **依赖表**:
     - 无

6. **Attendance** (考勤表)
   - **字段**:
     - `AttendanceID` (考勤编号, INT, PK)
     - `EmployeeID` (员工编号, INT, FK)
     - `Date` (日期, DATE)
     - `Type` (考勤类型, NVARCHAR(50))
   - **依赖表**:
     - `Employee` (员工表)

7. **MonthlySalary** (月度工资表)
   - **字段**:
     - `SalaryID` (工资编号, INT, PK)
     - `EmployeeID` (员工编号, INT, FK)
     - `Month` (月份, DATE)
     - `BasicSalary` (基本工资, DECIMAL(10, 2))
     - `PositionSalary` (职位工资, DECIMAL(10, 2))
     - `TitleSalary` (职称工资, DECIMAL(10, 2))
     - `TenureSalary` (工龄工资, DECIMAL(10, 2))
     - `AttendanceDeduction` (考勤扣除, DECIMAL(10, 2))
     - `FullAttendanceBonus` (全勤奖励, DECIMAL(10, 2))
     - `TotalSalary` (总工资, DECIMAL(10, 2))
   - **依赖表**:
     - `Employee` (员工表)

8. **TenureSalary** (工龄工资表)
   - **字段**:
     - `EmployeeID` (员工编号, INT, PK, FK)
     - `Tenure` (工龄, INT)
     - `Salary` (工龄工资, DECIMAL(10, 2))
   - **依赖表**:
     - `Employee` (员工表)

9. **NewTenureSalary** (新工龄工资表)
   - **字段**:
     - `EmployeeID` (员工编号, INT, PK, FK)
     - `NewTenure` (新工龄, INT)
     - `EffectiveDate` (生效日期, DATE)
     - `EndDate` (结束日期, DATE)
   - **依赖表**:
     - Employee (员工表)

10. **SalaryAdjustment** (工资调整表)
    - **字段**:
      - `AdjustmentID` (调整编号, INT, PK)
      - `EmployeeID` (员工编号, INT, FK)
      - `CategoryID` (类别编号, INT, FK)
      - `Amount` (金额, DECIMAL(10, 2))
      - `Month` (月份, DATE)
    - **依赖表**:
      - `Employee` (员工表)
      - `SalaryCategory` (工资类别表)

11. **EmployeeTitleHistory** (员工职称历史表)
    - **字段**:
      - `EmployeeID` (员工编号, INT, PK, FK)
      - `TitleID` (职称编号, INT, PK, FK)
      - `StartDate` (开始日期, DATE, PK)
      - `EndDate` (结束日期, DATE)
    - **依赖表**:
      - `Employee` (员工表)
      - `Title` (职称表)

### 视图设计

1. **DepartmentView** (部门视图)
   - **字段**:
     - `DepartmentID` (部门编号, INT)
     - `Name` (部门名称, VARCHAR(50))
     - `ManagerName` (部门经理姓名, VARCHAR(50))
   - **依赖表**:
     - `Department` (部门表)
     - `Employee` (员工表)

2. **EmployeeView** (员工视图)
   - **字段**:
     - `EmployeeID` (员工编号, INT)
     - `Name` (姓名, VARCHAR(50))
     - `DepartmentName` (部门名称, VARCHAR(50))
     - `PositionName` (职位名称, VARCHAR(50))
     - `TitleName` (职称名称, VARCHAR(50))
     - `HireDate` (入职日期, DATE)
   - **依赖表**:
     - `Employee` (员工表)
     - `Department` (部门表)
     - `Position` (职位表)
     - `Title` (职称表)
     - `EmployeeTitleHistory` (员工职称历史表)

3. **AttendanceView** (考勤视图)
   - **字段**:
     - `AttendanceID` (考勤编号, INT)
     - `EmployeeID` (员工编号, INT)
     - `EmployeeName` (员工姓名, VARCHAR(50))
     - `Date` (日期, DATE)
     - `Type` (考勤类型, NVARCHAR(50))
   - **依赖表**:
     - `Attendance` (考勤表)
     - `Employee` (员工表)

4. **MonthlySalaryView** (月度工资视图)
   - **字段**:
     - `SalaryID` (工资编号, INT)
     - `EmployeeID` (员工编号, INT)
     - `EmployeeName` (员工姓名, VARCHAR(50))
     - `Month` (月份, DATE)
     - `BasicSalary` (基本工资, DECIMAL(10, 2))
     - `PositionSalary` (职位工资, DECIMAL(10, 2))
     - `TitleSalary` (职称工资, DECIMAL(10, 2))
     - `TenureSalary` (工龄工资, DECIMAL(10, 2))
     - `AttendanceDeduction` (考勤扣除, DECIMAL(10, 2))
     - `FullAttendanceBonus` (全勤奖励, DECIMAL(10, 2))
     - `TotalSalary` (总工资, DECIMAL(10, 2))
   - **依赖表**:
     - `MonthlySalary` (月度工资表)
     - `Employee` (员工表)

### 触发器设计

1. **AttendanceTrigger** (考勤触发器)
   - **描述**: 用于在考勤数据修改时实时更新缺勤工资和全勤奖励。
   - **依赖表**:
     - `Attendance` (考勤表)
     - `MonthlySalary` (月度工资表)

### 定时任务设计

1. **MonthlySalaryCalculationJob** (月度工资计算任务)
   - **描述**: 用于在工资发放日的凌晨一点计算新的月度工资发放表。
   - **依赖表**:
     - Employee (员工表)
     - Position (职位表)
     - Title (职称表)
     - TenureSalary (工龄工资表)
     - NewTenureSalary (新工龄工资表)
     - Attendance (考勤表)
     - SalaryAdjustment (工资调整表)
     - MonthlySalary (月度工资表)

